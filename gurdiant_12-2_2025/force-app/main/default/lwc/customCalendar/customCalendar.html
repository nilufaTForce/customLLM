<template>
    <lightning-card>
        <div class="exampleHolder" if:true={spinner}>
            <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
        </div>
        <div class="calendar-card">
            <div class="slds-theme_shade slds-box">
                <div class="slds-grid slds-grid_align-spread header-card">
                    <div class="slds-col">
                        <div class="slds-media slds-no-space slds-grow">
                            <div class="slds-media__figure">
                                <lightning-icon icon-name="standard:event" size="medium"></lightning-icon>
                            </div>
                            <div class="slds-media__body">
                                <p class="slds-line-height_reset">Patients' Appointments</p>
                                <h1 class="slds-page-header__title slds-truncate">{calendarTitle}</h1>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="filters" style="display: flex;">
                        <div  class="providor"  style="display: flex; align-items: center;">
                            <div style="padding: 0 1rem;">Affiliated Group: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="affiliatedGroup" 
                                value={selectedAffiliatedgroup} 
                                placeholder="Select Affiliated Group" 
                                options={affiliatedGroupOptionsOnCalendar} 
                                onchange={handleAffiliatedGroupChange}>
                            </lightning-combobox></div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="padding: 0 1rem;">Group Locations: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="groupLocations" 
                                value={selectedGroupLocation} 
                                placeholder="Select Group Location" 
                                options={groupLocationsOptionsOnCalendar} 
                                onchange={handleGroupLocationChange}>
                            </lightning-combobox></div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="padding: 0 1rem;">Provider types: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="providerTypes" 
                                value={selectedProviderType} 
                                placeholder="Select Provider Type" 
                                options={providerTypesOptionsOnCalendar} 
                                onchange={handleProviderTypeChange}>
                            </lightning-combobox>
                        </div></div>
                        <div  class="providor" style="display: flex; align-items: center; ">
                            <div style="padding: 0 1rem;">Provider: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="providers" 
                                value={selectedProvider} 
                                placeholder="Select Provider" 
                                options={providerOptionsOnCalendar} 
                                onchange={handleProviderChange}>
                            </lightning-combobox>
                        </div></div>
                        <div class="buttons" style="display: flex; align-items: center;">
                        
                            <lightning-button 
                                label="New Appointment" 
                                class="slds-button slds-var-m-horizontal_small responsive-button button" 

                               
                                onclick={openNewAppointmentModal}>
                            </lightning-button>
                            <lightning-button-menu 
                                alternative-text="More actions" 
                                variant="border-filled" 
                                icon-name="utility:threedots" 
                                class="slds-var-m-horizontal_small" 
                                menu-alignment="auto" 
                                onselect={calendarActionsHandler}>
                                <lightning-menu-item value="previous" label="Previous"  onclick={calendarActionsHandler}></lightning-menu-item>
                                <lightning-menu-item value="next" label="Next"   onclick={calendarActionsHandler}></lightning-menu-item>
                                <lightning-menu-item value="today" label="Today"   onclick={calendarActionsHandler}></lightning-menu-item>
                                <lightning-menu-item value="refresh" label="Refresh"  onclick={calendarActionsHandler}></lightning-menu-item>
                            </lightning-button-menu> </div> 
                        </div> -->
                        <div class="slds-col">
                            <lightning-button label="New Appointment" class="slds-var-m-horizontal_small" value="new"
                            onclick={openNewAppointmentModal}>
                        </lightning-button>
                            <lightning-button-icon variant="border-filled" icon-name="utility:chevronleft" value="previous"
                                onclick={calendarActionsHandler} style="margin-right: 4px;">
                            </lightning-button-icon>
    
                            <lightning-button-icon variant="border-filled" icon-name="utility:chevronright" value="next"
                                onclick={calendarActionsHandler}>
                            </lightning-button-icon>
    
                            <lightning-button label="Today" class="slds-var-m-horizontal_small" value="today"
                                onclick={calendarActionsHandler}>
                            </lightning-button>
                            <!-- <lightning-button label="New" class="slds-var-m-horizontal_small" value="new"
                                onclick={openNewAppointmentModal}>
                            </lightning-button> -->

                            
                            <lightning-button-icon variant="border-filled" icon-name="utility:filterList"
                            class="slds-var-m-left_medium" value="filter" onclick={calendarActionsHandler}>
                        </lightning-button-icon>
    
                            <lightning-button-icon variant="border-filled" icon-name="utility:refresh"
                                class="slds-var-m-left_medium" value="refresh" onclick={calendarActionsHandler}>
                            </lightning-button-icon>
    
                            <lightning-button-menu alternative-text="Show menu" variant="border-filled"
                                icon-name="utility:event" class="slds-var-m-horizontal_small" menu-alignment="auto"
                                onselect={changeViewHandler}>
                                <template for:each={viewOptions} for:item="menuItem">
                                    <lightning-menu-item key={menuItem.viewName} value={menuItem.viewName}
                                        label={menuItem.label} checked={menuItem.checked}>
                                    </lightning-menu-item>
                                </template>
                            </lightning-button-menu>
                        </div>


                        <template if:true={filter}>


                            <div
                            style="display: flex; justify-content: center; align-items: center; width:1200px; background-color: white">
                            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
                                class="slds-modal slds-fade-in-open  slds-modal_medium"
                                style="justify-content: center; display:flex;align-items:center">
            
                                <div class="slds-modal__container" style="width: 900px;">
                                    <button class="slds-button slds-button_icon slds-modal__close" onclick={closeFilterModal}>
                                        <lightning-icon icon-name="utility:close" alternative-text="Close"
                                            size="small"></lightning-icon>
                                        <span class="slds-assistive-text">Cancel and close</span>
                                    </button>
            
                                    <header class="slds-modal__header">
                                        <h2 class="slds-text-heading_medium">Filter</h2>
                                    </header>
            
                                    <div style="background:white; max-height: 580px;"   >
                                                        <div class="slds-section" style="margin-bottom: 56px; margin-top:24px">
                                        
                                                            <h3 class="slds-section__title">
                                                                <button aria-controls="expando-unique-id" aria-expanded={isExpanded}
                                                                    class="slds-button slds-section__title-action slds-grid  slds-justify_between"
                                                                    onclick={toggleSection} type="button">
                                            <lightning-icon if:false={isExpanded} icon-name="utility:chevronright" size="x-small"
                                                                        class="slds-m-right_small"></lightning-icon>
                                                                    <lightning-icon if:true={isExpanded} icon-name="utility:chevrondown" size="x-small"
                                                                        class="slds-m-right_small"></lightning-icon>
                                                                    <span class="slds-truncate" title="Section Title">General Information {value}</span>
                                        
                                                                </button>
                                                            </h3>
                                                            <div if:true={isExpanded}>
                                        
                                                                <div if:true={isAppointment}>
                                                                    <!-- Appointment-specific fields -->
                                                                    <div class="slds-grid slds-gutters slds-p-around_small">
                                                                        <!-- All the fields for Appointment type -->
                                                                        <div class="slds-col" style="width: 50%;">
                                                                            <lightning-combobox variant="label-inline" options={affiliatedGroupOptionsOnCalendar}
                                                                             label="Affiliated Group" 
                                                                              onchange={handleAffiliatedGroupChange}
                                                                              value={selectedAffiliatedgroup}
                                                                            placeholder="Select Affiliated Group">
                                                                        </lightning-combobox>  
                                                                        
                                                                        <lightning-combobox variant="label-inline" options={groupLocationsOptionsOnCalendar}
                                                                        label="Group Locations" onchange={handleGroupLocationChange}
                                                                        required={isGrpLocationRequired} placeholder="Select Group Locations"
                                                                        value={selectedgrpLocationID}>
                                                                    </lightning-combobox>
                                        
                                                                  
                                                                        </div>
                                        
                                                                        <!-- Additional columns for Appointment -->
                                                                        <div class="slds-col"  style="width: 50%;">
                                                                            <lightning-combobox variant="label-inline" options={providerTypesOptionsOnCalendar}
                                                                                placeholder="Select Provider Type" label="Provider Type"
                                                                                onchange={handleProviderTypeChange} required={isProviderTypeRequired}
                                                                                value={selectedProviderType}>
                                                                            </lightning-combobox>
                                        
                                                                            <lightning-combobox variant="label-inline" options={providerOptionsOnCalendar}
                                                                                placeholder="Select Provider" label="Providers" onchange={handleProviderChange}
                                                                                value={selectedProvider} required={isProviderRequired}>
                                                                            </lightning-combobox>
                                        
                                                                         
                                                                        </div>
                                                                    </div>
                                                                </div>
                                        
                                                           
                                        
                                                            </div>
                                                        </div>
                                        
                                                        <div class="slds-popover__footer slds-docked-form-footer"
                                                            style="position: sticky; margin-bottom: -2%; display: block; text-align: center;">
                                                            <div>
                                                                <button type="button" class="slds-button slds-button_neutral"
                                                                    onclick={resetFilter}>Reset Filter</button>
                                                                <button onclick={handleFilters} class="slds-button slds-button_brand">Apply Filter</button>
                                                            </div>
                                                            <div class="slds-text-color_error">{errorMessage}</div>
                                                        </div>
                                        
                                        
                                                    </div>
                                        
                                        
                                                    <div if:true={calender}>
                                        
                                        
                                                        <div class="wrapper">
                                        
                                        
                                                            <div class="calender">
                                                                <div class="header">
                                                                    <h1>Chose Date</h1>
                                                                </div>
                                                                <div class="body">
                                                                    <div class="month-row">
                                                                        <div>
                                                                            <lightning-icon icon-name="utility:chevronleft" alternative-text="Close"
                                                                                size="x-small" onclick={handlePrev} class="icon-color"></lightning-icon>
                                                                        </div>
                                        
                                                                        <h1 style="margin-right: 8px;  margin-left: 8px; font-weight: 600;font-size: 13px;">
                                                                            {selectedYear} {selectedMonth} </h1>
                                                                        <lightning-icon icon-name="utility:chevronright" alternative-text="Close" size="x-small"
                                                                            onclick={handleNext} class="icon-color"></lightning-icon>
                                                                    </div>
                                                                    <div class="weeks">
                                                                        <ul>
                                                                            <template for:each={weeks} for:item="item">
                                                                                <li key={item}>{item}</li>
                                                                            </template>
                                                                        </ul>
                                                                    </div>
                                                                    <div class="days">
                                                                        <ul>
                                                                            <template for:each={days} for:item="item">
                                                                                <li if:true={item.isToday} key={item.day} data-day={item.day}
                                                                                    style="cursor:pointer" onclick={handleSelectedDate}
                                                                                    class="enableDates selected">{item.day} </li>
                                        
                                                                                <div if:false={item.isToday} key={item.day}>
                                                                                    <li if:false={item.isPast} data-day={item.day}
                                                                                        style="cursor:pointer;border: 1px solid #1e1c1c;"
                                                                                        onclick={handleSelectedDate} class="enableDates">{item.day}</li>
                                                                                </div>
                                                                                <li if:true={item.isPast} key={item.day}
                                                                                    style="color: rgba(128, 128, 128, 0.671);cursor:not-allowed">{item.day}
                                                                                </li>
                                                                            </template>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="selected-date-col ">
                                                                <!-- <div class="selected-date">
                                                                    <h1>{clickedFullDate}</h1>
                                                                </div> -->
                                                                <div class="header">
                                                                    <h1>Choose Time</h1>
                                                                </div>
                                        
                                                                <div class="list-container">
                                                                    <template if:true={timeOptions}>
                                                                        <template for:each={timeOptions} for:item="item">
                                        
                                                                            <div key={item.value} class="list-item" onclick={handleSelectedTime}>
                                                                                {item.label}
                                                                            </div>
                                                                        </template>
                                                                    </template>
                                                                </div>
                                                                <!-- <lightning-combobox 
                                                                label="Available Time" 
                                                                class="selected-date-duration"
                                                                value={selectedTime} 
                                                                options={timeOptions} 
                                                                onchange={handleTimeChange}>
                                                                    </lightning-combobox> -->
                                                                <!-- <lightning-combobox 
                                                                    label="Duration" 
                                                                    class="selected-date-duration"
                                                                    value={selectedTime} 
                                                                    options={durationOptions} 
                                                                    onchange={handleInputChange} data-id="duration">
                                                                </lightning-combobox> -->
                                        
                                                            </div>
                                        
                                                        </div>
                                        
                                                        <!-- <div class="slds-docked-form-footer">
                                                            <button type="button" class="slds-button slds-button_neutral"
                                                                onclick={closeAppointmentModal}>Cancel</button>
                                                            <button type="button" class="slds-button slds-button_brand">Create Appointment</button>
                                                        </div> -->
                                        
                                        
                                                        <!-- <div class="slds-align_absolute-center">
                                                    <div if:true={fromCalendar}>
                                                        <lightning-button variant="neutral" label="Close" onclick={closeAppointmentModal}></lightning-button>
                                                    </div>
                                                    &nbsp;&nbsp;&nbsp;
                                                    <lightning-button variant="brand" name="save" label="Create"></lightning-button>
                                                </div> -->
                                        
                                        
                                        
                                        
                                        
                                            <lightning-spinner if:true={spinner} alternative-text="Loading..." variant="brand">
                                            </lightning-spinner>
                                        
                     


































































































































                                        <!-- <c-new-appointment></c-new-appointment> -->
                                    </div>
                                    <lightning-spinner if:true={spinner} alternative-text="Loading..." variant="brand">
                                    </lightning-spinner>
                                </div>
                            </section>
                        </div>
                        <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
                        
                        
                        
                        
                            <!-- </div> -->
                        </template>
                 
                 
                    </div>
                </div>
            </div>
      
        <div class="fullcalendar">

        </div>


        <template if:true={showMorePopover}>
            <div class="custom-popover"
                style="background-color:white; border: 1px solid #ccc; padding: 10px; border-radius: 4px;">
                <h4>More Events</h4>
                <ul>
                    <template for:each={hiddenEvents} for:item="event">
                        <li key={event.id} onclick={handleEventClick}>{event.title}</li>
                    </template>
                </ul>
                <button onclick={closeMorePopover}>Close</button>
            </div>
        </template>




    
        <div if:true={appointmentDetailModal}>
            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
                class="slds-modal slds-fade-in-open modal-body scrollable  slds-var-p-around_medium">
                <div class="slds-modal__container">
                    <div class="slds-button slds-button_icon slds-modal__close">
                        <lightning-button-icon icon-name="utility:close" alternative-text="Add User" title="Preview"
                            onclick={closeModalOnClick}></lightning-button-icon>
                    </div>
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate" tabindex="-1">Appointment
                            Details
                        </h1>
                    </div>
                    <div class="slds-modal__content slds-var-p-around_medium" id="modal-content-id-1">
                        <div class="slds-grid slds-wrap">
                            <c-modal-view appointment-details={appointmentDetails}></c-modal-view>
                        </div>
                    </div>
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" aria-label="Cancel and close"
                            onclick={closeModalOnClick}>Close</button>
                    </div>
                </div>

            </section>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </div>




        <template if:true={newRecordTypeModal}>

            <div
                style="display: flex; justify-content: center; align-items: center; width:1200px; background-color: white">
                <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
                    class="slds-modal slds-fade-in-open  slds-modal_medium"
                    style="justify-content: center; display:flex;align-items:center">

                    <div class="slds-modal__container" style="width: 900px;">
                        <button class="slds-button slds-button_icon slds-modal__close" onclick={closeAppointmentModal}>
                            <lightning-icon icon-name="utility:close" alternative-text="Close"
                                size="small"></lightning-icon>
                            <span class="slds-assistive-text">Cancel and close</span>
                        </button>

                        <header class="slds-modal__header">
                            <h2 class="slds-text-heading_medium"> New Appointment</h2>
                        </header>

                        <div style="background:white; max-height: 580px; overflow: scroll;"
                            if:true={newRecordTypeModal}>
                            <c-new-appointment onappointmentclose={getChildCloseDataOnClick}
                                onappointmentnext={getChildNextOnClick} onappointmentstart={getChildStartOnClick}
                                onappointmentsave={reloadCalendar} from-calendar="true"></c-new-appointment>
                        </div>
                        <lightning-spinner if:true={spinner} alternative-text="Loading..." variant="brand">
                        </lightning-spinner>
                    </div>
                </section>
            </div>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </template>


    </lightning-card>
</template>