<template>


    <lightning-tabset active-tab-value={activeTab}>
        <!-- <lightning-tab label="Location" value="1" onactive={handleActiveTab}>

            <div style={marginStyle}>
                <lightning-input type="text" label="Patient Address" onchange={setClinicLocation}></lightning-input>
                <br>
                <lightning-button variant="brand" label="Search" onclick={handleLocationSearchClick}></lightning-button>
            </div>
        </lightning-tab> -->
        <lightning-tab label="Select event type" value="2" onactive={handleActiveTab}>
            <div if:true={form} class="slds-popover__body">

                <!-- <lightning-record-form object-api-name="Appointment__c" mode="edit"
                    onsubmit={handleFormSubmit}> -->
                <!-- </lightning-record-form> -->

                <div style=" display: flex; justify-content: center; margin: 16px;  margin-top: 0px;">
                    <div style="text-align: right; font-weight: bold; margin-right: 6px; margin-top: 8px;">Select an
                        event:</div>

                    <lightning-radio-group name="recordType" options={radioRecordOptions}
                        value={selectedRecordTypeValue} onchange={handleRadioRecordChange} class="no-outline-radio">
                    </lightning-radio-group>
                </div>


                <div class="slds-section">

                    <h3 class="slds-section__title">
                        <button aria-controls="expando-unique-id" aria-expanded={isExpanded}
                            class="slds-button slds-section__title-action slds-grid  slds-justify_between"
                            onclick={toggleSection} type="button">



                            <lightning-icon if:false={isExpanded} icon-name="utility:chevronright" size="x-small"
                                class="slds-m-right_small"></lightning-icon>
                            <lightning-icon if:true={isExpanded} icon-name="utility:chevrondown" size="x-small"
                                class="slds-m-right_small"></lightning-icon>
                            <span class="slds-truncate" title="Section Title">Information {checkk}</span>

                        </button>
                    </h3>
                    <div if:true={isExpanded}>

                        <div if:true={isAppointment}>
                            <!-- Appointment-specific fields -->
                            <div class="slds-grid slds-gutters slds-p-around_small">
         
                                <!-- All the fields for Appointment type -->
                                <div class="slds-col">

                              
                                    <template if:true={accountID}>
                                        <lightning-record-picker 
                                        object-api-name="Account" 
                                        label="Patients"
                                        placeholder="Search Patients" 
                                        variant="label-inline" 
                                        value={accountID} onchange={handlePatientChange}
                                        disabled>
                                    </lightning-record-picker>
                                </template>
                                     
                                        <!-- <h1>Hiiiiiiiiiiiiiiiii</h1> -->
                                        <template if:false={accountID}>
                                        <div if:true={filterPatients.criteria}>
                                            <lightning-record-picker object-api-name="Account" label="Patients"
                                                placeholder="Search Patients" variant="label-inline" filter={filterPatients}
                                                required={isPatientRequired} onchange={handlePatientChange} >
                                            </lightning-record-picker>
                                        </div>
                                        <div if:false={filterPatients.criteria}>
                                            <lightning-record-picker object-api-name="Account" label="Patients"
                                                placeholder="Search Patients" variant="label-inline" disabled>
                                            </lightning-record-picker>
                                        </div>
    
                                    </template>
                                    <!-- <h1>Hiiiiiiiiiiiiiiiii</h1> -->
                                    <!-- <div if:true={filterPatients.criteria}>
                                        <lightning-record-picker object-api-name="Account" label="Patients"
                                            placeholder="Search Patients" variant="label-inline" filter={filterPatients}
                                            required={isPatientRequired} onchange={handlePatientChange}>
                                        </lightning-record-picker>
                                    </div>
                                    <div if:false={filterPatients.criteria}>
                                        <lightning-record-picker object-api-name="Account" label="Patients"
                                            placeholder="Search Patients" variant="label-inline" disabled>
                                        </lightning-record-picker>
                                    </div> -->




                                    <div>

                                        <lightning-combobox label="Care Category" variant="label-inline"
                                            placeholder="Select Care Category" options={allCareCategories}
                                            onchange={handleCareCatChange} required={isCareCatRequired}
                                            value={selectedCareCatID}>
                                        </lightning-combobox>
                                    </div>
                                    <div>
                                        <!-- <span>Appointment Type</span> -->
                                        <lightning-combobox label="Appointment Type" variant="label-inline"
                                            options={appTypesOptions} onchange={handleAppTypeChange}
                                            placeholder="Select Appointment Type..." required={isAppTypeRequired}
                                            value={selectedAppTypeID}>
                                        </lightning-combobox>
                                    </div>
                                    <div>

                                        <lightning-combobox value={telehealthDefault} label="Telehealth"
                                            variant="label-inline" options={telehealthOptions}
                                            onchange={handletelehealthChange} required={isTelehealthRequired}>
                                        </lightning-combobox>

                                    </div>
                                    <lightning-input type="text" label="Duration" value={selectedDuration}
                                        placeholder="" variant="label-inline" disabled="true"></lightning-input>

                                    <lightning-input variant="label-inline" type="date" label="Date" min={appTodayDate}
                                        placeholder="Select Date" required={isDateRequired}
                                        onchange={handleDateChange}></lightning-input>
                                    <!--         
                                    <lightning-input variant="label-inline" type="time" label="Start Time" placeholder="Select Start Time"
                                        onchange={handleStartTimeChange} required={isStartTimeRequired}></lightning-input> -->
                                    <!-- <label> Start Time</label> -->

                                    <lightning-combobox class="startTimeInAppointment" value={startTime}
                                        label="Start Time" required="true" options={startTimeOptions}
                                        variant="label-inline" 
                                        disabled={isStartTimeDisabled}
                                        onchange={handleStartTimeChange}>
                                    </lightning-combobox>

                                    <lightning-input variant="label-inline" type="time" label="End Time" value={endTime}
                                        disabled="true"></lightning-input>

                                    <lightning-combobox value={selectedRoomType} label="Room Type" read-only="true"
                                        options={roomTypeOptions} variant="label-inline">
                                    </lightning-combobox>
                                </div>

                                <!-- Additional columns for Appointment -->
                                <div class="slds-col">
                                    <lightning-combobox variant="label-inline" options={grpOptions}
                                        value={selectedGrpID} label="Affiliated Group" disabled={isTelehealth}
                                        onchange={handleGroupChange} required={isGroupRequired}
                                        placeholder="Select Affiliated Group">
                                    </lightning-combobox>

                                    <lightning-combobox variant="label-inline" options={grpLocationOps}
                                        label="Group Locations" onchange={handleGroLocationChange}
                                        required={isGrpLocationRequired} placeholder="Select Group Locations"
                                        value={selectedgrpLocationID}>
                                    </lightning-combobox>

                                    <lightning-textarea variant="label-inline" label="Location Address"
                                        value={groupAddress} disabled="true">
                                    </lightning-textarea>

                                    <lightning-combobox variant="label-inline" options={providerTypeOptions}
                                        placeholder="Select Provider Type" label="Provider Type"
                                        onchange={handleProviderTypeChange} required={isProviderTypeRequired}
                                        value={selectedProviderTypeID}>
                                    </lightning-combobox>

                                    <lightning-combobox variant="label-inline" options={providerOptions}
                                        placeholder="Select Provider" label="Providers" onchange={handleProviderChange}
                                        value={selectedProvider} required={isProviderRequired}>
                                    </lightning-combobox>

                                    <lightning-textarea variant="label-inline" name="note" onchange={handleNotesChange}
                                        label="Note"></lightning-textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Conditional rendering for Unavailable fields -->
                        <div if:true={isUnavailable}>
                            <div class="slds-grid slds-gutters slds-p-around_small">
                                <!-- All the fields for Appointment type -->
                                <div class="slds-col">




                                    <!-- <lightning-combobox label="Location Radius" variant="label-inline"  placeholder="Set a Radius"
                                        options={locationRadiusOptions} onchange={handleLocationRadiusChange} required>
                                    </lightning-combobox> -->

                                    <lightning-combobox label="Care Category" variant="label-inline"
                                        placeholder="Select Care Category" options={allCareCategories}
                                        onchange={handleCareCatChangeU} required={isCareCatRequired}
                                        value={selectedCareCatU}>
                                    </lightning-combobox>





                                    <lightning-input variant="label-inline" type="date" label="Date" min={appTodayDate}
                                        placeholder="Select Date" required={isDateRequired}
                                        onchange={handleDateChangeU}></lightning-input>

                                    <lightning-combobox class="startTimeInAppointment" value={startTimeU}
                                        label="Start Time" required={isStartTimeRequired} options={startTimeOptions}
                                        variant="label-inline" onchange={handleStartTimeChangeU} disabled={isStartTimeDisabled} >
                                    </lightning-combobox>


                                    <lightning-combobox variant="label-inline" label="End Time" options={endTimeOptions}
                                        placeholder="Select End Time" value={endTimeU} onchange={handleEndTimeChangeU}
                                        disabled={isEndTimeDisabled} required="true"></lightning-combobox>
                                    <template if:true={timeErrorMessage}>
                                        <p class="slds-text-color_error" style="padding-left: 33%;">{timeErrorMessage}
                                        </p>
                                    </template>

                                    <lightning-input type="text" label="Duration" value={selectedDurationU}
                                        placeholder=" " variant="label-inline" disabled="true"></lightning-input>



                                </div>

                                <!-- Additional columns for Appointment -->
                                <div class="slds-col">
                                    <lightning-combobox variant="label-inline" options={grpOptionsUnavailable}
                                        value={selectedGroupU} placeholder="Select Affiliated Group"
                                        label="Affiliated Group" disabled={isTelehealth} onchange={handleGroupChangeU}
                                        required={isGroupRequired}>
                                    </lightning-combobox>

                                    <lightning-combobox variant="label-inline" options={grpLocationOpsUnavailable}
                                        value={selectedGrpLocationU} label="Group Locations"
                                        onchange={handleGroLocationChangeU} required={isGrpLocationRequired}
                                        placeholder="Select Group Locations">
                                    </lightning-combobox>

                                    <lightning-textarea variant="label-inline" label="Location Address"
                                        value={groupAddressU} disabled="true">
                                    </lightning-textarea>

                                    <lightning-combobox variant="label-inline" options={providerTypeOptionsUnavailable}
                                        placeholder="Select Provider Type" label="Provider Type"
                                        onchange={handleProviderTypeChangeU} required={isProviderTypeRequired}
                                        value={selectedProviderTypeU}>
                                    </lightning-combobox>

                                    <lightning-combobox variant="label-inline" options={providerOptionsUnavailable}
                                        placeholder="Select Provider " label="Providers"
                                        onchange={handleProviderChangeU} required={isProviderRequired}
                                        value={selectedProviderU}>
                                    </lightning-combobox>

                                    <lightning-textarea variant="label-inline" name="note" onchange={handleNotesChangeU}
                                        value = {selectedNoteU} label="Note"></lightning-textarea>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="slds-popover__footer slds-docked-form-footer"
                    style="position: sticky; margin-bottom: -2%; display: block; text-align: center;">
                    <div>
                        <button type="button" class="slds-button slds-button_neutral"
                            onclick={closeAppointmentModal}>Cancel</button>
                        <button onclick={createNewAppointment} class="slds-button slds-button_brand">Save</button>
                    </div>
                    <div class="slds-text-color_error">{errorMessage}</div>
                </div>


            </div>


            <div if:true={calender}>


                <div class="wrapper">


                    <div class="calender">
                        <div class="header">
                            <h1>Chose Date</h1>
                        </div>
                        <div class="body">
                            <div class="month-row">
                                <div>
                                    <lightning-icon icon-name="utility:chevronleft" alternative-text="Close"
                                        size="x-small" onclick={handlePrev} class="icon-color"></lightning-icon>
                                </div>

                                <h1 style="margin-right: 8px;  margin-left: 8px; font-weight: 600;font-size: 13px;">
                                    {selectedYear} {selectedMonth} </h1>
                                <lightning-icon icon-name="utility:chevronright" alternative-text="Close" size="x-small"
                                    onclick={handleNext} class="icon-color"></lightning-icon>
                            </div>
                            <div class="weeks">
                                <ul>
                                    <template for:each={weeks} for:item="item">
                                        <li key={item}>{item}</li>
                                    </template>
                                </ul>
                            </div>
                            <div class="days">
                                <ul>
                                    <template for:each={days} for:item="item">
                                        <li if:true={item.isToday} key={item.day} data-day={item.day}
                                            style="cursor:pointer" onclick={handleSelectedDate}
                                            class="enableDates selected">{item.day} </li>

                                        <div if:false={item.isToday} key={item.day}>
                                            <li if:false={item.isPast} data-day={item.day}
                                                style="cursor:pointer;border: 1px solid #1e1c1c;"
                                                onclick={handleSelectedDate} class="enableDates">{item.day}</li>
                                        </div>
                                        <li if:true={item.isPast} key={item.day}
                                            style="color: rgba(128, 128, 128, 0.671);cursor:not-allowed">{item.day}
                                        </li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="selected-date-col ">
                        <!-- <div class="selected-date">
                            <h1>{clickedFullDate}</h1>
                        </div> -->
                        <div class="header">
                            <h1>Choose Time</h1>
                        </div>

                        <div class="list-container">
                            <template if:true={timeOptions}>
                                <template for:each={timeOptions} for:item="item">

                                    <div key={item.value} class="list-item" onclick={handleSelectedTime}>
                                        {item.label}
                                    </div>
                                </template>
                            </template>
                        </div>
                        <!-- <lightning-combobox 
                        label="Available Time" 
                        class="selected-date-duration"
                        value={selectedTime} 
                        options={timeOptions} 
                        onchange={handleTimeChange}>
                            </lightning-combobox> -->
                        <!-- <lightning-combobox 
                            label="Duration" 
                            class="selected-date-duration"
                            value={selectedTime} 
                            options={durationOptions} 
                            onchange={handleInputChange} data-id="duration">
                        </lightning-combobox> -->

                    </div>

                </div>

                <!-- <div class="slds-docked-form-footer">
                    <button type="button" class="slds-button slds-button_neutral"
                        onclick={closeAppointmentModal}>Cancel</button>
                    <button type="button" class="slds-button slds-button_brand">Create Appointment</button>
                </div> -->


                <!-- <div class="slds-align_absolute-center">
            <div if:true={fromCalendar}>
                <lightning-button variant="neutral" label="Close" onclick={closeAppointmentModal}></lightning-button>
            </div>
            &nbsp;&nbsp;&nbsp;
            <lightning-button variant="brand" name="save" label="Create"></lightning-button>
        </div> -->


            </div>



        </lightning-tab>
    </lightning-tabset>


    <lightning-spinner if:true={spinner} alternative-text="Loading..." variant="brand">
    </lightning-spinner>





    <!-- </div> -->
</template>