<template>
    <lightning-card>
        <div class="exampleHolder" if:true={spinner}>
            <lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
        </div>
        <div class="calendar-card">
            <div class="slds-theme_shade slds-box">
                <div class="slds-grid slds-grid_align-spread header-card">
                    <div class="slds-col">
                        <div class="slds-media slds-no-space slds-grow">
                            <div class="slds-media__figure">
                                <lightning-icon icon-name="standard:event" size="medium"></lightning-icon>
                            </div>
                            <div class="slds-media__body">
                                <p class="slds-line-height_reset">Patients' Appointments</p>
                                <h1 class="slds-page-header__title slds-truncate">{calendarTitle}</h1>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="filters" style="display: flex;">
                        <div  class="providor"  style="display: flex; align-items: center;">
                            <div style="padding: 0 1rem;">Affiliated Group: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="affiliatedGroup" 
                                value={selectedAffiliatedgroup} 
                                placeholder="Select Affiliated Group" 
                                options={affiliatedGroupOptionsOnCalendar} 
                                onchange={handleAffiliatedGroupChange}>
                            </lightning-combobox></div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="padding: 0 1rem;">Group Locations: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="groupLocations" 
                                value={selectedGroupLocation} 
                                placeholder="Select Group Location" 
                                options={groupLocationsOptionsOnCalendar} 
                                onchange={handleGroupLocationChange}>
                            </lightning-combobox></div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="padding: 0 1rem;">Provider types: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="providerTypes" 
                                value={selectedProviderType} 
                                placeholder="Select Provider Type" 
                                options={providerTypesOptionsOnCalendar} 
                                onchange={handleProviderTypeChange}>
                            </lightning-combobox>
                        </div></div>
                        <div  class="providor" style="display: flex; align-items: center; ">
                            <div style="padding: 0 1rem;">Provider: </div>
                            <div class="slds-col" style="margin-top: -1rem; max-width: 8rem;">
                            <lightning-combobox 
                                name="providers" 
                                value={selectedProvider} 
                                placeholder="Select Provider" 
                                options={providerOptionsOnCalendar} 
                                onchange={handleProviderChange}>
                            </lightning-combobox>
                        </div></div>
                        <div class="buttons" style="display: flex; align-items: center;">
                        
                            <lightning-button 
                                label="New Appointment"
                                class="slds-button slds-var-m-horizontal_small responsive-button button" 
                                onclick={openNewAppointmentModal}>
                            </lightning-button>
                            <lightning-button-menu 
                                alternative-text="More actions" 
                                variant="border-filled" 
                                icon-name="utility:threedots" 
                                class="slds-var-m-horizontal_small" 
                                menu-alignment="auto" 
                                onselect={calendarActionsHandler}>
                                <lightning-menu-item value="previous" label="Previous"  onclick={calendarActionsHandler}></lightning-menu-item>
                                <lightning-menu-item value="next" label="Next"   onclick={calendarActionsHandler}></lightning-menu-item>
                                <lightning-menu-item value="today" label="Today"   onclick={calendarActionsHandler}></lightning-menu-item>
                                <lightning-menu-item value="refresh" label="Refresh"  onclick={calendarActionsHandler}></lightning-menu-item>
                            </lightning-button-menu> </div> 
                        </div> -->
                        <div class="slds-col">
                            <lightning-button-icon variant="border-filled" icon-name="utility:chevronleft" value="previous"
                                onclick={calendarActionsHandler}>
                            </lightning-button-icon>
    
                            <lightning-button-icon variant="border-filled" icon-name="utility:chevronright" value="next"
                                onclick={calendarActionsHandler}>
                            </lightning-button-icon>
    
                            <lightning-button label="Today" class="slds-var-m-horizontal_small" value="today"
                                onclick={calendarActionsHandler}>
                            </lightning-button>
                            <lightning-button label="New" class="slds-var-m-horizontal_small" value="new"
                                onclick={openNewAppointmentModal}>
                            </lightning-button>
    
                            <lightning-button-icon variant="border-filled" icon-name="utility:refresh"
                                class="slds-var-m-left_medium" value="refresh" onclick={calendarActionsHandler}>
                            </lightning-button-icon>
    
                            <lightning-button-menu alternative-text="Show menu" variant="border-filled"
                                icon-name="utility:event" class="slds-var-m-horizontal_small" menu-alignment="auto"
                                onselect={changeViewHandler}>
                                <template for:each={viewOptions} for:item="menuItem">
                                    <lightning-menu-item key={menuItem.viewName} value={menuItem.viewName}
                                        label={menuItem.label} checked={menuItem.checked}>
                                    </lightning-menu-item>
                                </template>
                            </lightning-button-menu>
                        </div>
                   
                   
                    </div>
                </div>
            </div>
      
        <div class="fullcalendar">

        </div>


        <template if:true={showMorePopover}>
            <div class="custom-popover"
                style="background-color:white; border: 1px solid #ccc; padding: 10px; border-radius: 4px;">
                <h4>More Events</h4>
                <ul>
                    <template for:each={hiddenEvents} for:item="event">
                        <li key={event.id} onclick={handleEventClick}>{event.title}</li>
                    </template>
                </ul>
                <button onclick={closeMorePopover}>Close</button>
            </div>
        </template>




    
        <div if:true={appointmentDetailModal}>
            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
                class="slds-modal slds-fade-in-open modal-body scrollable  slds-var-p-around_medium">
                <div class="slds-modal__container">
                    <div class="slds-button slds-button_icon slds-modal__close">
                        <lightning-button-icon icon-name="utility:close" alternative-text="Add User" title="Preview"
                            onclick={closeModalOnClick}></lightning-button-icon>
                    </div>
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate" tabindex="-1">Appointment
                            Details
                        </h1>
                    </div>
                    <div class="slds-modal__content slds-var-p-around_medium" id="modal-content-id-1">
                        <div class="slds-grid slds-wrap">
                            <c-modal-view appointment-details={appointmentDetails}></c-modal-view>
                        </div>
                    </div>
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" aria-label="Cancel and close"
                            onclick={closeModalOnClick}>Close</button>
                    </div>
                </div>

            </section>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </div>




        <template if:true={newRecordTypeModal}>

            <div
                style="display: flex; justify-content: center; align-items: center; width:1200px; background-color: white">
                <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
                    class="slds-modal slds-fade-in-open  slds-modal_medium"
                    style="justify-content: center; display:flex;align-items:center">

                    <div class="slds-modal__container" style="width: 900px;">
                        <button class="slds-button slds-button_icon slds-modal__close" onclick={closeAppointmentModal}>
                            <lightning-icon icon-name="utility:close" alternative-text="Close"
                                size="small"></lightning-icon>
                            <span class="slds-assistive-text">Cancel and close</span>
                        </button>

                        <header class="slds-modal__header">
                            <h2 class="slds-text-heading_medium">New Appointment</h2>
                        </header>

                        <div style="background:white; max-height: 580px; overflow: scroll;"
                            if:true={newRecordTypeModal}>
                            <c-new-appointment onappointmentclose={getChildCloseDataOnClick}
                                onappointmentnext={getChildNextOnClick} onappointmentstart={getChildStartOnClick}
                                onappointmentsave={reloadCalendar} from-calendar="true"></c-new-appointment>
                        </div>
                        <lightning-spinner if:true={spinner} alternative-text="Loading..." variant="brand">
                        </lightning-spinner>
                    </div>
                </section>
            </div>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </template>


    </lightning-card>
</template>